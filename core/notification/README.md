# Firebase Cloud Messaging (FCM)

-----

## Sending Test Messages via API

This guide demonstrates how to send a test message to a single device using the FCM v1 HTTP API.

### 1. Obtain an OAuth 2.0 Authorization Token

To authorize your requests, you need a short-lived OAuth 2.0 access token.

1. Go to the [OAuth 2.0 Playground](https://developers.google.com/oauthplayground/?authuser=0).
2. In "Step 1: Select & authorize APIs", find and select **Firebase Cloud Messaging API v1**.
    * Ensure the scope `https://www.googleapis.com/auth/firebase.messaging` is authorized.
3. Click **Authorize APIs**.
4. You will be prompted to sign in with your Google account and grant permissions.
5. In "Step 2: Exchange authorization code for tokens", click **Exchange authorization code for
   tokens**.
6. Copy the displayed **Access token**. This token is valid for a limited time (usually one hour).

For more details on OAuth 2.0,
see [Using OAuth 2.0 to Access Google APIs](https://developers.google.com/identity/protocols/oauth2?authuser=0).

**IMPORTANT SECURITY NOTE:**

* **Never hardcode your Authorization Bearer token in your application code or commit it to version
  control.** These tokens are sensitive and provide access to your Firebase project.
* For automated or production environments, use the Firebase Admin SDK with service account
  credentials, as described below.

### 2. Get the Target Device Registration Token

You need the FCM registration token for the specific device you want to send the message to. This
token is generated by the client app instance.

**SECURITY NOTE:** Device tokens are also sensitive. Securely store and manage them on your server
if you plan to send messages to specific devices regularly.

### 3. Send the Message

For sending a message to a single device, replace `YOUR_PROJECT_ID`, `YOUR_OAUTH2_ACCESS_TOKEN`, and
`TARGET_DEVICE_REGISTRATION_TOKEN` with your actual Firebase Project ID, the OAuth 2.0 token
obtained in Step 1, and the target device's FCM token.

For more details on sending messages,
see [Send messages to specific devices](https://firebase.google.com/docs/cloud-messaging/send-message).

```shell
curl --location 'https://fcm.googleapis.com/v1/projects/YOUR_PROJECT_ID/messages:send' \
     --header 'Authorization: Bearer YOUR_OAUTH2_ACCESS_TOKEN' \
     --header 'Content-Type: application/json' \
     --data '{
         "message": {
             "data": {
                 "title": "FCM Message",
                 "body": "This is an FCM Message",
                 "uri": "https://br.com.ricarlo.recipes/home",
                 "source": "FCM"
             },
             "token": "TARGET_DEVICE_REGISTRATION_TOKEN"
         }
     }'
```

### Understanding the Message Payload

The `message` object in the JSON payload can contain:

* **`token`**: The registration token of the target device.
* **`data`**: (As shown above) A key-value payload of custom data. Your client app receives this
  data in its `onMessageReceived` callback (or equivalent) and is responsible for handling it (e.g.,
  displaying a custom notification, updating UI, performing background tasks). This is useful for
  silent pushes or when you need full control over the notification's appearance and behavior
  client-side.
* **`notification`**: (Optional) A predefined set of user-visible keys like `title` and `body`. If
  included, and the app is in the background or killed, the FCM SDK on the client device may
  automatically display a system notification. You can combine `notification` and `data` payloads.
